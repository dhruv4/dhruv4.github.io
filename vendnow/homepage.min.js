function initialize(){if(geocoder=new google.maps.Geocoder,directionsDisplay=new google.maps.DirectionsRenderer,mapOptions={zoom:14,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.HYBRID]}},map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions),infoWindow=new google.maps.InfoWindow,navigator.geolocation){navigator.geolocation.getCurrentPosition(function(e){pos=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);var t=new google.maps.Marker({position:pos,map:map,title:"Current Location",icon:"/media/current-loc.png"});google.maps.event.addListener(t,"click",function(){infowindow&&infowindow.close(),infowindow.setContent("<div class='noscrollbar'>Your location</div>"),infowindow.open(map,t)}),currentPos=pos,startPos=pos,map.setCenter(pos),map.setZoom(18)},function(){alert("Error: The Geolocation service failed."),currentPos=pos,map.setCenter(pos)})}else alert("Error: Your browser doesn't support geolocation."),currentPos=pos,map.setCenter(pos);directionsDisplay.setMap(map),directionsDisplay.setPanel(document.getElementById("directionsCardCont")),google.maps.event.addListener(map,"drag",function(){currentPos=map.getCenter(),geoQuery.updateCriteria({center:[currentPos.lat(),currentPos.lng()],radius:getRadius()})}),google.maps.event.addListener(map,"zoom_changed",function(){currentPos=map.getCenter(),geoQuery.updateCriteria({center:[currentPos.lat(),currentPos.lng()],radius:getRadius()})})}function clearOverlays(){for(var e=0;e<markers.length;e++)markers[e].setMap(null)}function searchLocations(){var e=document.getElementById("id_address").value,t=new google.maps.Geocoder;t.geocode({address:e},function(t,o){o==google.maps.GeocoderStatus.OK?(currentPos=t[0].geometry.location,startPos=t[0].geometry.location,geoQuery.updateCriteria({center:[currentPos.lat(),currentPos.lng()],radius:getRadius()}),map.setCenter(t[0].geometry.location),map.setZoom(15)):""!=e.trim()&&alert(e+" not found")})}function createMarker(e){if(latlng=new google.maps.LatLng(e.lat,e.lng),e.report<3)var t="<b>"+e.name+"</b><br/>"+e.address+"<br/>"+e.description+"<br/>"+e.type+"<br/><button class='btn waves-effect waves-light red' title='Report Out of Order' onclick='updateVote(\""+e.key+"\", \"report\", 1, this)'><i class='material-icons'>report_problem</i></button><button class='btn waves-effect waves-light blue' title='Get directions' onclick='calcRoute("+latlng.lat()+", "+latlng.lng()+")'><i class='material-icons'>directions</i></button><button class='btn waves-effect waves-light orange' title='Reviews' onclick='review(\""+e.key+"\")'><i class='material-icons'>rate_review</i></button><a target='_blank' class='twitter-icon btn waves-effect waves-light light-blue' title='Share to Twitter' href='https://twitter.com/intent/tweet?via=vendnowapp&text=Check out the Vending Machine I found at "+e.name+" with vend-now.com!'></a>";else var t="<b>"+e.name+"</b><br/>"+e.address+"<br/>"+e.description+"<br/>"+e.type+"<br/><span class='red-text'>Reported Out of Order</span><br/><button title='Report Working' class='btn waves-effect waves-light green' onclick='updateVote(\""+e.key+"\", \"report\", -1, this)'><i class='material-icons'>report_problem</i></button><button title='Get directions' class='btn waves-effect waves-light blue' onclick='calcRoute("+latlng.lat()+", "+latlng.lng()+")'><i class='material-icons'>directions</i></button><a target='_blank' class='twitter-icon btn waves-effect waves-light light-blue' title='Share to Twitter' href='https://twitter.com/intent/tweet?via=vendnowapp&text=Check out the Vending Machine I found at "+e.name+" with vend-now.com!'></a>";1==e.restricted&&(t+="<br/><span class='red-text'>Restricted Access</span>");var o=new google.maps.Marker({map:map,position:latlng});o.setIcon("Snack"==e.type?"/media/icons/candy.png":"Drink"==e.type?"/media/icons/drink.png":"Redbox"==e.type||"Movie"==e.type?"/media/icons/movierental.png":"Electronics"==e.type?"/media/icons/phones.png":"Momba"==e.type?"/media/icons/momba.png":"/media/icons/blank.png"),google.maps.event.addListener(o,"click",function(){infoWindow.setContent(t),infoWindow.open(map,o),map.setCenter(o.getPosition())}),e.marker=o}function getRadius(){var e=map.getBounds();if(void 0==e||null==e)return"25";var t=e.getCenter(),o=e.getNorthEast(),a=3963,n=t.lat()/57.2958,i=t.lng()/57.2958,r=o.lat()/57.2958,s=o.lng()/57.2958,l=a*Math.acos(Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos(s-i));return l}function calcRoute(e,t,o){$("#directionsCard").show(),endPos=new google.maps.LatLng(e,t);var a;a=o?google.maps.TravelMode.WALKING:google.maps.TravelMode.DRIVING;var n={origin:startPos,destination:endPos,travelMode:a};directionsService.route(n,function(e,t){t==google.maps.DirectionsStatus.OK&&setDirections(e)})}function calcRouteChange(e,t,o){endPos=new google.maps.LatLng(e,t);var a;a=o?google.maps.TravelMode.WALKING:google.maps.TravelMode.DRIVING;var n={origin:startPos,destination:endPos,travelMode:a};directionsService.route(n,function(e,t){t==google.maps.DirectionsStatus.OK&&directionsDisplay.setDirections(e)})}function setDirections(e){$("#switchDirType")&&$("#switchDirType").remove();var t=document.createElement("div");t.innerHTML="<button onclick='calcRouteChange("+e.routes[0].legs[0].end_location.lat()+","+e.routes[0].legs[0].end_location.lng()+", false)' id='drive' class='btn waves-effect waves-light'><i class='material-icons'>drive_eta</i></button><button id='walk' onclick='calcRouteChange("+e.routes[0].legs[0].end_location.lat()+","+e.routes[0].legs[0].end_location.lng()+", true)' class='btn waves-effect waves-light'><i class='material-icons'>directions_walk</i></button><i id='closeDir' class='blue-grey-text darken-1 material-icons'>close</i>",t.id="switchDirType",t.className="card-title",directionsDisplay.setMap(map),directionsDisplay.setDirections(e),$("#directionsCard").prepend(t),$("#closeDir").click(function(){directionsDisplay.setMap(null),$("#directionsCard").hide(),$("#switchDirType").remove()})}function updateVote(e,t,o,a){myDataRef.child(e).child(t).set(vendsList[e].report+o),a.innerHTML="<i class='material-icons'>check_circle</i>",Materialize.toast("Reported!",4e3),a.disabled=!0}function review(e){$("#avg-review").hide(),$("#reviews-collection").hide(),$("#avg-review").text("Avg Rating: "),$("#reviews-collection").empty(),$("#no-review").show(),$("#modal-title").html(vendsList[e].name),$("#modal-type").html(vendsList[e].type),vendsList[e].numberofreviews>0&&($("#avg-review").show(),$("#reviews-collection").show(),$("#no-review").hide()),rateID=e;for(var t=vendsList[e].avgrating-1;t>=0;t--)$("#avg-review").append('<i class="mdi-action-star-rate"></i>');for(var t in vendsList[e].reviews)$("#reviews-collection").append("<li class='collection-item'><h6>"+vendsList[e].reviews[t].username+"</h6><p>"+vendsList[e].reviews[t].reasoning+"</p><p>"+vendsList[e].reviews[t].rating+" stars</p></li>");$("#review-modal").openModal()}function rated(){return console.log(rateVal),console.log(rateID),console.log($("#user-name").val()),console.log($("#reasoning").val()),0==rateVal?void $("#star-error").text("Please Rate!"):0==$("#reasoning").val().trim().length?void $("#reasoning-error").text("Please Review!"):(""==$("#user-name").val()&&$("#user-name").val("Anonymous"),myDataRef.child(rateID).child("numberofreviews").set(vendsList[rateID].numberofreviews+1),myDataRef.child(rateID).child("avgrating").set((vendsList[rateID].avgrating+rateVal)/(vendsList[rateID].numberofreviews+1)),myDataRef.child(rateID).child("reviews").push({username:$("#user-name").val(),reasoning:$("#reasoning").val(),rating:rateVal}),Materialize.toast("Rated!",4e3),$("#review-modal").closeModal(),rateVal=0,$("#user-name").val(""),$("#reasoning").val(""),$("#star-error").text(""),$("#reasoning-error").text(""),void $("i.mdi-action-star-rate").each(function(){$(this).css("color","gray")}))}var map,directionsDisplay,pos=new google.maps.LatLng(42.374168,-71.116977),directionsService=new google.maps.DirectionsService,markers=[],geocoder,infoWindow,resultsBox,clicked,currentPos=pos,startPos=pos,myDataRef=new Firebase("https://vendnow.firebaseio.com/"),geoFire=new GeoFire(myDataRef.child("_geofire")),vendsList={},geoQuery=geoFire.query({center:[currentPos.lat(),currentPos.lng()],radius:0}),rateVal=0,rateID;$(document).ready(function(){$("body").keypress(function(e){13==e.keyCode&&$("#find_vends").click()}),$(".modal-trigger").leanModal({dismissible:!0,opacity:.5,in_duration:300,out_duration:200}),$("i.mdi-action-star-rate.rate").on("click",function(){console.log($(this).attr("value")),rateVal=parseInt($(this).attr("value")),$("i.mdi-action-star-rate").each(function(){console.log(parseInt($(this).attr("value"))),parseInt($(this).attr("value"))>rateVal?$(this).css("color","gray"):$(this).css("color","gold")})})}),google.maps.event.addDomListener(window,"load",initialize),geoQuery.on("key_entered",function(e){vendsList[e]=!0,myDataRef.child(e).once("value",function(t){vend=t.val(),null!==vend&&vendsList[e]===!0&&(vendsList[e]=vend,createMarker(vend))})}),geoQuery.on("key_exited",function(e){var t=vendsList[e];t.marker.setMap(null),delete vendsList[e]}),window.onload=function(){document.getElementById("id_address").value="",document.getElementById("id_address").focus()};